---
import type { EventDetail } from '../lib/webeTypes';
import modalScriptUrl from '../scripts/eventModal.client.js?url';

interface Props {
	events: EventDetail[];
}

const { events } = Astro.props satisfies Props;

const festivalTimeZone = import.meta.env.PUBLIC_FESTIVAL_TIMEZONE ?? 'America/Phoenix';
const eventTimeFormatter = new Intl.DateTimeFormat('en-US', {
	hour: 'numeric',
	minute: '2-digit',
	timeZone: festivalTimeZone,
});

const formatEventTime = (value: string) => {
	const date = new Date(value);
	if (Number.isNaN(date.getTime())) {
		return value;
	}
	return eventTimeFormatter.format(date);
};
---
<div aria-hidden="true">
	{events.map((event) => (
		<dialog
			id={`modal-${event.id}`}
			data-event-modal="true"
			class="backdrop:bg-slate-950/80 w-full max-w-2xl rounded-3xl border border-slate-700/60 bg-slate-900/95 p-0 text-slate-100 shadow-2xl"
			aria-labelledby={`modal-title-${event.id}`}
		>
			<div class="flex flex-col gap-6 p-8">
				<div class="flex items-start justify-between gap-4">
					<div>
						<p class="text-xs font-semibold uppercase tracking-[0.3em] text-fuchsia-300/80">{event.stage}</p>
						<h3 id={`modal-title-${event.id}`} class="mt-2 text-3xl font-bold text-white">
							{event.title}
						</h3>
					</div>
					<button
						type="button"
						class="flex h-10 w-10 items-center justify-center rounded-full border border-slate-700/70 bg-slate-800/60 text-slate-300 transition hover:border-slate-500 hover:text-white"
						data-close-modal={`modal-${event.id}`}
					>
						<span class="sr-only">Close modal</span>
						&times;
					</button>
				</div>
				<img src={event.image.src} alt={event.image.alt} class="h-60 w-full rounded-2xl object-cover object-center" />
				<div class="flex flex-wrap gap-4 text-sm text-slate-200">
					<div class="flex items-center gap-2">
						<span class="inline-flex h-2 w-2 rounded-full bg-emerald-400"></span>
						<span>{event.dayLabel}</span>
					</div>
					<div class="flex items-center gap-2">
						<span class="inline-flex h-2 w-2 rounded-full bg-cyan-400"></span>
						<span>{formatEventTime(event.start)} ‚Äì {formatEventTime(event.end)}</span>
					</div>
					<div class="flex items-center gap-2">
						<span class="inline-flex h-2 w-2 rounded-full bg-fuchsia-400"></span>
						<span>{event.area}</span>
					</div>
				</div>
				<p class="text-base leading-relaxed text-slate-100">{event.description}</p>
				{event.tags.length > 0 && (
					<ul class="flex flex-wrap gap-2">
						{event.tags.map((tag) => (
							<li key={tag} class="rounded-full border border-slate-600/70 bg-slate-800/80 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-slate-100">
								{tag.replace('-', ' ')}
							</li>
						))}
					</ul>
				)}
			</div>
		</dialog>
	))}
	<dialog
		id="modal-camping-info"
		data-event-modal="true"
		class="backdrop:bg-slate-950/80 w-full max-w-3xl rounded-3xl border border-slate-700/60 bg-slate-900/95 p-0 text-slate-100 shadow-2xl"
		aria-labelledby="modal-title-camping"
	>
		<div class="flex flex-col gap-6 p-8">
			<div class="flex items-start justify-between gap-4">
				<div>
					<p class="text-xs font-semibold uppercase tracking-[0.3em] text-fuchsia-300/80">Overnight Stay</p>
					<h3 id="modal-title-camping" class="mt-2 text-3xl font-bold text-white">
						üèïÔ∏è Howling at the Moon Fest ‚Äî Camping Rules &amp; Agreement
					</h3>
				</div>
				<button
					type="button"
					class="flex h-10 w-10 items-center justify-center rounded-full border border-slate-700/70 bg-slate-800/60 text-slate-300 transition hover:border-slate-500 hover:text-white"
					data-close-modal="modal-camping-info"
				>
					<span class="sr-only">Close modal</span>
					&times;
				</button>
			</div>
			<div class="grid gap-3 rounded-2xl border border-slate-700/60 bg-slate-900/60 p-6 text-sm text-slate-200">
				<p><span class="font-semibold text-white">Camping Rate:</span> $25.00 per day</p>
				<p><span class="font-semibold text-white">Payment:</span> Must be paid in full up front before setting up camp.</p>
				<p><span class="font-semibold text-white">Event Duration:</span> 2 days</p>
				<p><span class="font-semibold text-white">Check-Out Time:</span> 12:00 PM (noon) the day after the second day of the event.</p>
			</div>
			<div class="space-y-4 text-sm text-slate-200">
				<h4 class="text-lg font-semibold text-white">Campground Rules</h4>
				<ol class="space-y-3 list-decimal pl-5">
					<li>
						<p class="font-semibold text-white">Park at Your Own Risk</p>
						<p class="mt-1 text-slate-300">The camping area is extremely rocky, with many large and sometimes sharp rocks.</p>
						<p class="text-slate-300">Although we work hard to find and remove as many rocks as possible, plenty remain in the ground.</p>
						<p class="text-slate-300">The festival and venue are not responsible for any flat tires, punctures, or vehicle damage caused by terrain conditions.</p>
					</li>
					<li>
						<p class="font-semibold text-white">Noise Policy</p>
						<p class="mt-1 text-slate-300">No loud music is permitted during the festival‚Äôs live music performances.</p>
						<p class="text-slate-300">Quiet hours begin at 10:00 PM each night. Please respect other campers and nearby residents.</p>
					</li>
					<li>
						<p class="font-semibold text-white">Cooking and Campfires</p>
						<p class="mt-1 text-slate-300">Cooking is only allowed at your campsite.</p>
						<p class="text-slate-300">No cooking or open flames are permitted inside the main event seating area.</p>
						<p class="text-slate-300">Please use safe cooking practices and keep fire safety equipment nearby.</p>
					</li>
					<li>
						<p class="font-semibold text-white">Cleanup</p>
						<p class="mt-1 text-slate-300">Leave your campsite as you found it. Dispose of all trash properly.</p>
					</li>
					<li>
						<p class="font-semibold text-white">Responsibility</p>
						<p class="mt-1 text-slate-300">The festival and property owners are not liable for any injury, loss, or damage to personal property.</p>
						<p class="text-slate-300">Campers are responsible for their own safety and belongings.</p>
					</li>
				</ol>
			</div>
			<div class="rounded-2xl border border-fuchsia-500/40 bg-fuchsia-500/5 p-6 text-sm text-slate-200">
				<p class="font-semibold text-white">For Questions or Assistance:</p>
				<p class="mt-2 text-slate-200">üìû Contact Lola at <a href="tel:13608805545" class="font-semibold text-fuchsia-200 underline underline-offset-4 transition hover:text-fuchsia-100">(360) 880-5545</a></p>
			</div>
		</div>
	</dialog>
</div>
<script type="module" src={modalScriptUrl}></script>
