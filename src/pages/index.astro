---
import BaseLayout from '../layouts/BaseLayout.astro';
import EventModals from '../components/EventModals.astro';
import GalleryModals from '../components/GalleryModals.astro';
import { fetchFestivalContent } from '../lib/webeFriendsClient';

const festival = await fetchFestivalContent();
const hero = festival.hero;
const events = festival.events;
const scheduleDays = festival.schedule.days;
const gallery = festival.gallery;
const sponsors = festival.sponsors;
const faqs = festival.faqs;

const pageTitle = hero?.title ?? festival.meta.siteName ?? 'WeBeFriends Integration';
const pageDescription = hero?.description ?? `Latest content powered by WeBeFriends for ${festival.meta.siteName ?? 'this site'}.`;
const ogImage = hero?.background?.src ?? '/images/hero/moonrise.svg';

const eventsById = new Map(events.map((event) => [event.id, event]));
const standardGatesOpen = '10:00 AM';
const scheduleWithEvents = scheduleDays.map((slot) => ({
	...slot,
	gatesOpen: standardGatesOpen,
	events: slot.eventIds
		.map((eventId) => eventsById.get(eventId))
		.filter((event): event is NonNullable<typeof event> => Boolean(event)),
}));

const hasHero = Boolean(hero);
const hasGallery = gallery.length > 0;
const hasSponsors = sponsors.length > 0;
const hasFaqs = faqs.length > 0;
const hasMapsKey = Boolean(import.meta.env.PUBLIC_GOOGLE_MAPS_KEY);
const mapQueryRaw = (import.meta.env.PUBLIC_GOOGLE_MAPS_QUERY ?? 'Yuma Territorial Prison State Historic Park, Yuma AZ').trim();
const mapZoomParsed = Number.parseInt(import.meta.env.PUBLIC_GOOGLE_MAPS_ZOOM ?? '', 10);
const mapZoom = Number.isFinite(mapZoomParsed) ? mapZoomParsed : 15;
const mapId = (import.meta.env.PUBLIC_GOOGLE_MAPS_MAP_ID ?? '').trim();
const mapPreferCloud =
	!import.meta.env.DEV && (import.meta.env.PUBLIC_GOOGLE_MAPS_USE_MAP_ID ?? '').trim().toLowerCase() === 'true';
const mapLocationLabel = pageTitle;
const mapCoverImage = '/images/howlin-map-cover.png';
const mapToggleLabel = hasMapsKey ? 'Click to view the map' : 'Add your map key to enable the map';
const groundsMapScriptUrl = (await import('../scripts/groundsMap.client.js?url')).default;
const partnerSpotlightScriptUrl = (await import('../scripts/partnerSpotlight.client.js?url')).default;
const scheduleCarouselScriptUrl = (await import('../scripts/scheduleCarousel.client.js?url')).default;
const galleryRevealScriptUrl = (await import('../scripts/galleryReveal.client.js?url')).default;
const pageViewCounterScriptUrl = (await import('../scripts/pageViewCounter.js?url')).default;

const festivalTimeZone = import.meta.env.PUBLIC_FESTIVAL_TIMEZONE ?? 'America/Phoenix';
const eventTimeFormatter = new Intl.DateTimeFormat('en-US', {
	hour: 'numeric',
	minute: '2-digit',
	timeZone: festivalTimeZone,
});

const formatEventTime = (value: string) => {
	const date = new Date(value);
	if (Number.isNaN(date.getTime())) {
		return value;
	}
	return eventTimeFormatter.format(date);
};

const getOrdinal = (value: number) => {
	const modTen = value % 10;
	const modHundred = value % 100;
	if (modTen === 1 && modHundred !== 11) return 'st';
	if (modTen === 2 && modHundred !== 12) return 'nd';
	if (modTen === 3 && modHundred !== 13) return 'rd';
	return 'th';
};

const formatDateLabel = (date: Date, options?: { includeMonth?: boolean }) => {
	const includeMonth = options?.includeMonth ?? true;
	const month = date.toLocaleString('en-US', { month: 'short' });
	const day = date.getDate();
	const suffix = getOrdinal(day);
	return includeMonth ? `${month} ${day}${suffix}` : `${day}${suffix}`;
};

const now = new Date();
const eventsWithTemporalData = events
	.map((event) => {
		const startDate = new Date(event.start);
		const endDate = new Date(event.end);
		return { event, startDate, endDate };
	})
	.filter(({ startDate, endDate }) => !Number.isNaN(startDate.getTime()) && !Number.isNaN(endDate.getTime()))
	.sort((a, b) => a.startDate.getTime() - b.startDate.getTime());

const eventsGroupedByMonth = new Map<string, typeof eventsWithTemporalData>();
eventsWithTemporalData.forEach((entry) => {
	const monthKey = `${entry.startDate.getFullYear()}-${String(entry.startDate.getMonth() + 1).padStart(2, '0')}`;
	const bucket = eventsGroupedByMonth.get(monthKey);
	if (bucket) {
		bucket.push(entry);
	} else {
		eventsGroupedByMonth.set(monthKey, [entry]);
	}
});

const monthlyEventGroups = Array.from(eventsGroupedByMonth.values())
	.map((group) => {
		const sorted = [...group].sort((a, b) => a.startDate.getTime() - b.startDate.getTime());
		const firstDate = sorted[0]?.startDate;
		const finalEndDate = sorted[sorted.length - 1]?.endDate;
		if (!firstDate || !finalEndDate) {
			return undefined;
		}
		const expiry = new Date(finalEndDate);
		expiry.setHours(0, 0, 0, 0);
		expiry.setDate(expiry.getDate() + 1);
		return { events: sorted, firstDate, expiry };
	})
	.filter((group): group is { events: typeof eventsWithTemporalData; firstDate: Date; expiry: Date } => Boolean(group))
	.sort((a, b) => a.firstDate.getTime() - b.firstDate.getTime());

const activeMonthlyGroup =
	monthlyEventGroups.find((group) => now < group.expiry) ??
	monthlyEventGroups.find((group) => group.firstDate.getTime() >= now.getTime()) ??
	monthlyEventGroups[monthlyEventGroups.length - 1];

const featuredEvents = activeMonthlyGroup ? activeMonthlyGroup.events.slice(0, 2).map((entry) => entry.event) : [];
const hasHighlights = featuredEvents.length > 0;
const hasSchedule = scheduleWithEvents.length > 0;

const featuredEventDays = featuredEvents
	.map((event) => new Date(event.start))
	.filter((date) => !Number.isNaN(date.getTime()))
	.sort((a, b) => a.getTime() - b.getTime());

const uniqueFeaturedDays = Array.from(
	new Map(
		featuredEventDays.map((date) => {
			const key = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
			return [key, date] as const;
		})
	).values()
);

const nextEventDaysSlice = uniqueFeaturedDays.slice(0, 2);

let nextHowlingHeading = 'Next Howling';
if (nextEventDaysSlice.length === 1) {
	const [first] = nextEventDaysSlice;
	nextHowlingHeading = `Next Howling ${formatDateLabel(first)}`;
} else if (nextEventDaysSlice.length === 2) {
	const [first, second] = nextEventDaysSlice;
	const sameMonth = first.getMonth() === second.getMonth() && first.getFullYear() === second.getFullYear();
	if (sameMonth) {
		const monthLabel = first.toLocaleString('en-US', { month: 'short' });
		nextHowlingHeading = `Next Howling ${monthLabel} ${formatDateLabel(first, { includeMonth: false })} & ${formatDateLabel(second, { includeMonth: false })}`;
	} else {
		nextHowlingHeading = `Next Howling ${formatDateLabel(first)} & ${formatDateLabel(second)}`;
	}
}

---

<BaseLayout
	title={pageTitle}
	description={pageDescription}
	ogImage={ogImage}
>
	{hasHero && hero && (
		<section
			id="hero"
			class="relative isolate overflow-hidden bg-slate-900/60"
			style={hero.background?.src
				? `background-image: linear-gradient(135deg, rgba(15, 23, 42, 0.95), rgba(30, 41, 59, 0.85)), url(${hero.background.src}); background-size: cover; background-position: center;`
				: undefined}
		>
			<div class="absolute inset-0 bg-slate-950/50 backdrop-blur-sm"></div>
			<img
				src="/images/sky-moon.png"
				alt="Moonlit clouds"
				width="1080"
				height="919"
				loading="eager"
				decoding="async"
				fetchpriority="high"
				class="pointer-events-none absolute left-1/2 -top-28 block w-[160vw] -translate-x-1/2 max-w-none opacity-60 sm:left-auto sm:-right-16 sm:-top-10 sm:w-[115vw] sm:translate-x-0 sm:opacity-75 lg:-right-24 lg:-top-20 lg:w-[120vw]"
			/>
			<div class="relative mx-auto flex w-full max-w-6xl flex-col gap-12 px-6 py-24 lg:flex-row lg:items-center lg:py-32">
				<div class="flex-1 space-y-6">
					{hero.kicker && hero.kicker.toLowerCase() !== 'venue' && (
						<p class="text-xs font-semibold uppercase tracking-[0.5em] text-fuchsia-300/90">
							{hero.kicker}
						</p>
					)}
					<h1 class="text-4xl font-bold tracking-tight text-white sm:text-5xl lg:text-6xl">
						{hero.title}
					</h1>
					{hero.tagline && <p class="text-xl font-light text-slate-200 sm:text-2xl">{hero.tagline}</p>}
					{hero.description && <p class="max-w-xl text-base text-slate-300 sm:text-lg">{hero.description}</p>}
					<div class="group relative overflow-hidden rounded-3xl border border-fuchsia-500/40 bg-slate-950/45 p-6 shadow-[0_0_35px_-18px_rgba(217,70,239,0.65)] backdrop-blur" data-partner-card data-partner-placement="hero">
						<div class="absolute inset-0 bg-gradient-to-br from-fuchsia-500/5 via-transparent to-emerald-400/10 opacity-0 transition-opacity duration-500 group-hover:opacity-100 pointer-events-none"></div>
						<button
							type="button"
							class="partner-dismiss-button"
							data-partner-dismiss
							aria-label="Dismiss partner spotlight"
						>
							<span aria-hidden="true" class="partner-dismiss-label">X</span>
						</button>
						<div class="relative flex flex-col gap-5 sm:flex-row sm:items-center">
							<div class="flex items-center justify-center">
								<img
									src="/images/rtfyv.jpg"
									alt="Right Turn for Yuma Veterans logo"
									width="120"
									height="120"
									loading="lazy"
									class="h-24 w-24 rounded-full border border-fuchsia-400/60 bg-slate-900 object-cover shadow-[0_0_25px_-12px_rgba(217,70,239,0.65)]"
								/>
							</div>
							<div class="flex-1 space-y-3 text-slate-200">
								<p class="text-xs font-semibold uppercase tracking-[0.45em] text-fuchsia-300/90">Community Partner Spotlight</p>
								<h2 class="text-2xl font-semibold text-white sm:text-3xl">Right Turn for Yuma Veterans</h2>
								<p class="text-sm text-slate-300">
									Supporting Our Veterans &amp; Community â€” we're proud to partner with Right Turn for Yuma Veterans at every Howling at the Moon festival.
								</p>
							</div>
						</div>
						<div class="relative mt-5 space-y-3 text-sm text-slate-300 partner-card__body">
							<p data-partner-footer-teaser hidden class="partner-card__footer-teaser text-sm text-slate-300">
								They rally fundraising, volunteer crews, and hands-on care for every Howling nightâ€”open up for the full story.
							</p>
							<p data-partner-summary>
								Supporting our veterans &amp; community, Right Turn for Yuma Veterans brings mission-driven fundraising and on-the-ground support to every Howling at the Moon.
							</p>
							<div data-partner-details hidden class="space-y-3 partner-card__details">
								<p>
									This local charity is dedicated to uplifting veterans through hands-on support. Theyâ€™ll join us at each fest with fundraising fun like 50/50 drawings and interactive activitiesâ€”every dollar raised goes directly to their mission.
								</p>
								<p>
									In return, their incredible crew helps us with setup and teardown so the grounds stay welcoming for every Howler. Weâ€™re grateful for their service and the chance to give back alongside you.
								</p>
								<p class="text-xs uppercase tracking-[0.35em] text-emerald-300/80">Thank you for helping us make a difference.</p>
							</div>
							<button
								type="button"
								class="inline-flex items-center gap-2 rounded-full border border-transparent px-3 py-1 text-xs font-semibold uppercase tracking-[0.35em] text-emerald-200 transition hover:border-emerald-300/60 hover:text-white"
								data-partner-toggle
								aria-expanded="false"
							>
								Read more
							</button>
						</div>
						<div class="relative mt-6 flex flex-wrap gap-3">
							<button
								type="button"
								class="inline-flex items-center gap-2 rounded-full border border-emerald-400/70 bg-emerald-500/15 px-6 py-3 text-xs font-semibold uppercase tracking-[0.35em] text-emerald-100 transition hover:border-fuchsia-400 hover:text-white"
								data-open-modal="modal-camping-info"
							>
								Camping Info
							</button>
						</div>
					</div>
				</div>
				<div class="relative w-full flex-1 overflow-hidden rounded-3xl border border-slate-800/70 bg-slate-950/40 shadow-[0_0_35px_-10px_rgba(217,70,239,0.35)] mt-8 lg:mt-0 lg:max-w-xl">
					<video
						src="/videos/howl-crowd.mp4"
						autoplay
						loop
						muted
						playsinline
						preload="metadata"
						poster={hero.background?.src}
						class="aspect-video h-full w-full object-cover"
						aria-label="Crowd highlight reel from Howlin at the Moon"
					></video>
					<div class="pointer-events-none absolute inset-0 bg-gradient-to-tr from-slate-950/60 via-transparent to-fuchsia-500/10"></div>
				</div>
			</div>
		</section>
		<script type="module" src={partnerSpotlightScriptUrl}></script>
	)}

	{hasHighlights && (
		<section id="highlights" class="border-y border-slate-800 bg-slate-950/80">
			<div class="mx-auto flex w-full max-w-6xl flex-col gap-8 px-6 py-16">
				<div class="flex flex-col gap-4 sm:flex-row sm:items-end sm:justify-between">
					<div>
						<h2 class="mt-2 text-3xl font-semibold text-white sm:text-4xl">{nextHowlingHeading}</h2>
					</div>
				</div>
				<div class="grid gap-6 sm:grid-cols-2 sm:justify-items-center">
					{featuredEvents.map((event) => (
						<button
							key={event.id}
							type="button"
							class="group relative w-full max-w-md overflow-hidden rounded-3xl border border-slate-800 bg-slate-900/60 text-left transition hover:border-fuchsia-400/70 hover:shadow-fuchsia-500/20"
							data-open-modal={`modal-${event.id}`}
						>
							<img
								src={event.image.src}
								alt={event.image.alt}
								class="h-48 w-full object-cover object-center transition duration-500 group-hover:scale-105"
							/>
							<div class="flex flex-col gap-3 p-6">
								<p class="text-xs font-semibold uppercase tracking-[0.4em] text-fuchsia-300/90">{event.stage}</p>
								<h3 class="text-xl font-semibold text-white">{event.title}</h3>
								<p class="text-sm text-slate-300">
									{formatEventTime(event.start)} â€¢ {event.dayLabel}
								</p>
								<div class="flex flex-wrap gap-2">
									{event.tags.map((tag) => (
										<span key={tag} class="rounded-full bg-fuchsia-500/20 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-fuchsia-200">
											{tag.replace('-', ' ')}
										</span>
									))}
								</div>
							</div>
						</button>
					))}
				</div>
			</div>
		</section>
	)}

	<section id="grounds-map" class="border-t border-slate-800 bg-slate-950/85">
		<div class="mx-auto flex w-full max-w-6xl flex-col gap-8 px-6 py-20">
			<header class="flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between">
				<div>
					<h2 class="text-3xl font-semibold text-white sm:text-4xl">Festival Grounds Map</h2>
				</div>
			</header>
			<div
				data-map-container
				class={`relative overflow-hidden rounded-3xl border ${
					hasMapsKey ? 'border-slate-800 bg-slate-900/60' : 'border-dashed border-slate-700 bg-slate-900/40'
				}`}
				data-map-key={hasMapsKey ? import.meta.env.PUBLIC_GOOGLE_MAPS_KEY : ''}
				data-map-query={mapQueryRaw}
				data-map-zoom={String(mapZoom)}
				data-map-map-id={mapId}
				data-map-use-cloud={mapPreferCloud && mapId ? 'true' : 'false'}
				data-map-label={mapLocationLabel}
			>
				<div data-map-canvas class="hidden h-[420px] w-full"></div>
				<div class="pointer-events-none absolute inset-0 hidden items-center justify-center bg-slate-950/85 text-sm font-semibold uppercase tracking-[0.35em] text-fuchsia-100" data-map-loading>
					Loading mapâ€¦
				</div>
				<div class="pointer-events-none absolute inset-0 hidden items-center justify-center bg-rose-900/80 text-center text-sm font-semibold text-rose-100" data-map-error>
					We couldnâ€™t load the live map. Please check your Google Maps configuration.
				</div>
				<button
					type="button"
					data-map-toggle
					class={`group relative flex h-[420px] w-full items-center justify-center overflow-hidden text-white transition ${
						hasMapsKey ? 'border border-slate-800 hover:border-fuchsia-400/70 hover:shadow-[0_0_35px_-10px_rgba(217,70,239,0.45)]' : 'border border-dashed border-slate-700'
					}`}
					style="cursor: pointer;"
					disabled={!hasMapsKey}
				>
					<img
						src={mapCoverImage}
						alt="Stylized festival map teaser graphic"
						class="absolute inset-0 h-full w-full object-cover opacity-80 transition duration-500 group-hover:scale-105 group-hover:opacity-100"
					/>
					<div class="absolute inset-0 bg-gradient-to-br from-slate-950/85 via-slate-900/70 to-fuchsia-500/20"></div>
					<span class="relative z-10 text-center text-lg font-semibold uppercase tracking-[0.4em] text-fuchsia-100">
						{mapToggleLabel}
					</span>
				</button>
			</div>
			{!hasMapsKey && (
				<p class="text-sm text-slate-400">
					Add a Google Maps API key to the <code class="rounded bg-slate-900 px-2 py-1 text-xs text-slate-200">PUBLIC_GOOGLE_MAPS_KEY</code> variable in your <code class="rounded bg-slate-900 px-2 py-1 text-xs text-slate-200">.env.local</code> file to unlock the live map. Provide a custom location or coordinates with <code class="rounded bg-slate-900 px-2 py-1 text-xs text-slate-200">PUBLIC_GOOGLE_MAPS_QUERY</code> and an optional zoom via <code class="rounded bg-slate-900 px-2 py-1 text-xs text-slate-200">PUBLIC_GOOGLE_MAPS_ZOOM</code>.
				</p>
			)}
		</div>
		<script type="module" src={groundsMapScriptUrl}></script>
	</section>

	{hasSchedule && (
		<section id="schedule" class="bg-slate-950/90">
		<div class="mx-auto flex w-full max-w-6xl flex-col gap-10 px-6 py-20">
			<header class="flex flex-col gap-4">
				<p class="text-xs font-semibold uppercase tracking-[0.4em] text-emerald-300/80">See Our Events</p>
				<h2 class="text-3xl font-semibold text-white sm:text-4xl">Full Season Schedule</h2>
				<p class="max-w-3xl text-sm text-slate-300 sm:text-base">
					Remember Howlers â€” due to the unpredictable weather here in the foothills, all events are subject to change without notice. It's always best to check before heading out!
				</p>
			</header>
			<div class="relative">
				<div
					class="flex snap-x snap-mandatory gap-6 overflow-x-auto pb-4 [-ms-overflow-style:none] [scrollbar-width:none] [&::-webkit-scrollbar]:hidden lg:grid lg:grid-cols-2 lg:overflow-visible lg:pb-0 lg:snap-none"
					data-schedule-carousel
				>
					{scheduleWithEvents.map((slot, index) => {
						const isAdditionalSlot = index >= 3;
						return (
							<div
								key={`${slot.dateLabel}-${slot.dayLabel}`}
								class={`flex min-w-[85vw] flex-shrink-0 snap-center flex-col gap-6 rounded-3xl border border-slate-800 bg-slate-900/60 p-8 transition-transform lg:min-w-0 ${isAdditionalSlot ? 'hidden lg:flex' : ''}`}
								data-schedule-card
								data-mobile-hidden={isAdditionalSlot ? 'true' : 'false'}
							>
								<div class="flex items-baseline justify-between gap-4">
									<div>
										<p class="text-xs font-semibold uppercase tracking-[0.4em] text-cyan-300/80">{slot.dateLabel}</p>
										<h3 class="text-2xl font-semibold text-white">{slot.dayLabel}</h3>
									</div>
									<p class="text-sm font-semibold uppercase tracking-[0.35em] text-slate-400">Gates {slot.gatesOpen}</p>
								</div>
								<ul class="space-y-4">
									{slot.events.length > 0 ? (
										slot.events.map((event) => (
											<li key={event.id} class="flex flex-col gap-2 rounded-2xl border border-slate-800 bg-slate-950/60 p-4 transition hover:border-fuchsia-400/70">
												<div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
													<div>
														<p class="text-xs font-semibold uppercase tracking-[0.4em] text-slate-400">{event.stage}</p>
														<h4 class="text-lg font-semibold text-white">{event.title}</h4>
													</div>
													<div class="flex flex-col items-start text-sm font-medium text-slate-200 sm:items-end sm:text-right">
														<span>
															{formatEventTime(event.start)}
															<span class="mx-2 text-slate-500">â€“</span>
															{formatEventTime(event.end)}
														</span>
														<span class="mt-1 text-xs font-normal text-slate-500/80">The shows usually end 30-45 minutes after the moon rises.</span>
													</div>
												</div>
												<div class="flex flex-wrap gap-3 text-sm text-slate-300">
													<span class="rounded-full bg-emerald-500/20 px-3 py-1">
														{event.area}
													</span>
													<button
														type="button"
														class="rounded-full border border-slate-600/70 px-4 py-1 text-xs font-semibold uppercase tracking-wide text-slate-100 transition hover:border-fuchsia-400 hover:text-white"
														data-open-modal={`modal-${event.id}`}
													>
														Details
													</button>
												</div>
											</li>
										))
									) : (
										<li class="rounded-2xl border border-dashed border-slate-800 bg-slate-950/40 p-6 text-sm text-slate-400">
											Set list coming soon. Check back once new events are assigned in WeBeFriends.
										</li>
									)}
								</ul>
							</div>
						);
					})}
				</div>
				{scheduleWithEvents.length > 3 && (
					<div class="mt-4 flex justify-center lg:hidden">
						<button
							type="button"
							class="inline-flex items-center justify-center rounded-full border border-slate-700 bg-slate-900/70 px-6 py-2 text-xs font-semibold uppercase tracking-[0.35em] text-slate-100 transition hover:border-fuchsia-400 hover:text-white"
							data-schedule-show-more
						>
							See more
						</button>
					</div>
				)}
			</div>
			<script type="module" src={scheduleCarouselScriptUrl}></script>
		</div>
		</section>
	)}

	{hasGallery && (
		<section id="gallery" class="border-t border-slate-800 bg-slate-950/80">
		<div class="mx-auto flex w-full max-w-6xl flex-col gap-8 px-6 py-20">
			<header class="flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between">
				<div>
					<p class="text-xs font-semibold uppercase tracking-[0.4em] text-fuchsia-300/80">Memories</p>
					<h2 class="text-3xl font-semibold text-white sm:text-4xl">Festival Glimpses</h2>
				</div>
				<p class="max-w-xl text-sm text-slate-300">
					Some of the amazing times we have had out here, captured on film.
				</p>
			</header>
			<div class="grid gap-4 md:grid-cols-2 lg:grid-cols-4" data-gallery-grid>
				{gallery.map((image, index) => {
					const galleryKey = `gallery-${index}`;
					const modalId = `modal-gallery-${index}`;
					const caption = image.alt || `Festival photo ${index + 1}`;
					const isMobileHidden = index >= 3;
					return (
						<button
							key={image.src}
							type="button"
							class={`group relative overflow-hidden rounded-3xl border border-slate-800 bg-slate-900/50 text-left transition hover:border-fuchsia-400/70 focus:outline-none focus:ring-2 focus:ring-fuchsia-400/60 ${isMobileHidden ? 'hidden sm:block' : ''}`}
							data-gallery-toggle
							data-gallery-target={modalId}
							data-gallery-id={galleryKey}
							data-gallery-item
							data-gallery-mobile-hidden={isMobileHidden ? 'true' : 'false'}
						>
							<span
								class="absolute left-3 top-3 z-10 flex items-center gap-1 rounded-full bg-slate-950/80 px-3 py-1 text-xs font-semibold text-slate-200"
								data-gallery-badge-wrapper={galleryKey}
								aria-live="polite"
							>
								<span aria-hidden="true">ðŸ’¬</span>
								<span data-gallery-badge={galleryKey}>0</span>
								<span class="sr-only" data-gallery-badge-sr>0 comments on this photo</span>
							</span>
							<img
								src={image.src}
								alt={image.alt}
								class="h-52 w-full object-cover transition duration-500 group-hover:scale-105"
							/>
							<span class="absolute inset-x-0 bottom-0 bg-gradient-to-t from-slate-950/80 via-slate-950/50 to-transparent px-4 py-3 text-xs uppercase tracking-[0.3em] text-slate-200">
								{caption}
							</span>
							<span class="sr-only">Open full view of {caption}</span>
						</button>
					);
				})}
			</div>
				{gallery.length > 3 && (
					<div class="mt-6 flex justify-center sm:hidden">
						<button
							type="button"
							class="inline-flex items-center justify-center rounded-full border border-slate-700 bg-slate-900/70 px-6 py-2 text-xs font-semibold uppercase tracking-[0.35em] text-slate-100 transition hover:border-fuchsia-400 hover:text-white"
							data-gallery-show-more
						>
							See more memories
						</button>
					</div>
				)}
				<script type="module" src={galleryRevealScriptUrl}></script>
		</div>
		</section>
	)}

	{hasSponsors && (
		<section id="sponsors" class="bg-slate-900/70">
		<div class="mx-auto flex w-full max-w-6xl flex-col gap-8 px-6 py-20">
			<header class="flex flex-col gap-3">
				<p class="text-xs font-semibold uppercase tracking-[0.4em] text-emerald-300/80">Partners</p>
				<h2 class="text-3xl font-semibold text-white sm:text-4xl">Powered by the Pack</h2>
				<p class="max-w-2xl text-sm text-slate-300">
					Community sponsors and production partners make the festival glow. Shout-outs update automatically when WeBeFriends publishes new data.
				</p>
			</header>
			<div class="grid gap-6 md:grid-cols-2 xl:grid-cols-4">
				{sponsors.map((sponsor) => (
					<article key={sponsor.name} class="flex flex-col gap-3 rounded-3xl border border-slate-800 bg-slate-950/70 p-6">
						<p class="text-xs font-semibold uppercase tracking-[0.4em] text-fuchsia-300/80">{sponsor.tier}</p>
						<h3 class="text-lg font-semibold text-white">{sponsor.name}</h3>
						<p class="text-sm text-slate-300">{sponsor.description}</p>
					</article>
				))}
			</div>
		</div>
		</section>
	)}

	{hasFaqs && (
		<section id="faq" class="border-t border-slate-800 bg-slate-950/90">
		<div class="mx-auto flex w-full max-w-6xl flex-col gap-8 px-6 py-20">
			<header class="flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between">
				<div>
					<p class="text-xs font-semibold uppercase tracking-[0.4em] text-fuchsia-300/80">Know Before You Go</p>
					<h2 class="text-3xl font-semibold text-white sm:text-4xl">FAQs</h2>
				</div>
				<p class="max-w-xl text-sm text-slate-300">
					Operated directly from the WeBeFriends FAQ bundle, so your attendees always see the latest guidance.
				</p>
			</header>
			<div class="grid gap-6 md:grid-cols-2">
				{faqs.map((faq) => (
					<article key={faq.question} class="flex flex-col gap-3 rounded-3xl border border-slate-800 bg-slate-900/60 p-6">
						<h3 class="text-lg font-semibold text-white">{faq.question}</h3>
						<p class="text-sm text-slate-300">{faq.answer}</p>
					</article>
				))}
			</div>
		</div>
		</section>
	)}

	{hasGallery && <GalleryModals images={gallery} />}
	{events.length > 0 && <EventModals events={events} />}

		<script type="module" src={pageViewCounterScriptUrl}></script>

</BaseLayout>
